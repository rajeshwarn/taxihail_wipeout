@using CustomerPortal.Web.Security
@model CustomerPortal.Web.Areas.Admin.Models.DeploymentJobModel

@{
    ViewBag.Title = "History";
    Layout = "~/Views/Shared/_SettingsLayout.cshtml";
}

<div style="width: 980px; overflow: hidden">
    <div style="width: 860px; float: right; padding-bottom: 20px;">
        <h4>Deployment history</h4>
    </div>
</div>
@if (SecurityHelper.IsApcuriumUser)
{
    <div style="width: 100px; float: left; position: fixed">@Html.Partial("_DeployRevisionPartial")</div>

}
<div style="width: 870px; float: right">
    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th>Company</th>
                <th>User</th>
                <th>Status</th>
                <th>Server</th>
                <th>Action</th>
                <th>Date</th>
                <th>Revision</th>
                <th>Actions</th>
            </tr>
        </thead>

        @foreach (var deploy in Model.Jobs)
        {
            <tr>
                <td> <a href="@Url.Action("Manage", "Home", new {area = "Admin", id = deploy.Company.Id})">@deploy.Company.CompanyName</a></td>
                <td>@deploy.UserName</td>
                <td><a title="@deploy.Details" data-status data-key="@deploy.Id" href="@Url.Action("Details", new {id = deploy.Id})" class="btn btn-link">@deploy.Status</a></td>
                <td>@deploy.Server.Name</td>
                <td>@deploy.Action</td>
                <td>@deploy.Date.ToLocalTime()</td>
                <td>@deploy.Revision.Tag <br /> (@deploy.Revision.Commit)</td>

                <td>
                    @if (SecurityHelper.IsApcuriumUser)
                    {
                        <a href="@Url.Action("Copy", new {id = deploy.Id})">
                            <img src="~/Images/copy.png" width="20" />
                        </a>
                    }
                    <a href="@Url.Action("Index", "Version", new { area = "Admin", id = deploy.Company.Id })">
                        <img src="~/Images/download.jpg" width="20" />
                    </a>
                    @if (SecurityHelper.IsApcuriumUser)
                    {
                        <a href="@Url.Action("Index", "Settings", new {area = "Admin", id = deploy.Company.CompanyKey})">
                            <img src="~/Images/settings.jpg" width="20" />
                        </a>
                    }
                </td>
            </tr>
        }
    </table>
</div>