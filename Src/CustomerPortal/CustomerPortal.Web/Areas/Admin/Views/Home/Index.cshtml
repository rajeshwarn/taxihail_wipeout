@using CustomerPortal.Web.Security
@using CustomerPortal.Web.Areas.Admin.Controllers
@model dynamic
@{
    ViewBag.Title = "Home";
}
<div class='row'>
    <div class='span12'>
        <p>
            <a class="btn" href='@Url.Action("Create")'>New Company</a>
            <a class="btn" href='@Url.Action("Index", "Membership")'>Manage Users</a>
            <a class="btn" href="@Url.Action("Index", "Deployment")">Deployment</a>
            <a class="btn" href="@Url.Action("Index", "Payment")">Payment</a>                        
            <a class="btn" href="@Url.Action("RefreshVersions")">Refresh Versions</a>
            <a class="btn" href="@Url.Action("Index","StoreCredential")">Store Credentials</a>                        

        </p>
        View : &nbsp;
        <a href="@Url.Action("Default")">Default</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("Last10")">Last 10</a>
        &nbsp; | &nbsp;        
        <a href="@Url.Action("Index")">Customer Sites</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("Demo")">Demo</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("All")">All</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("OrderByPublishDate")">By publish date</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("NotPublished")">Not published</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("AssetReady")">Asset Ready</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("Open")">Open</a>
        &nbsp; | &nbsp;
        <a href="@Url.Action("StoreAvailableInTest")">Store</a>
        <br />
        Selected View : &nbsp;<strong>@ViewBag.ViewType</strong> 
    </div>

    <div class="span12">
        <table class="table table-striped table-condensed">
            <thead>
                <tr>
                    <th>Company name</th>
                    <th>Version</th>
                    <th>Status</th>
                    <th>Actions</th>
                    <th>Warnings</th>
                    <th>Store</th>
                </tr>
            </thead>
            @foreach (var company in Model)
            {
                <tr>
                    <td>                        
                        <a href="@Url.Action("Manage", new {company.Id})">@company.CompanyName</a>
                        <br />
                        <small><i>PO#: @company.Payment.PONumber</i></small>
                    </td>
                    <td><span data-version data-key="@company.CompanyKey">P:@company.LastKnownProductionVersion</span> <br/>
                        <span data-version-staging data-key="@company.CompanyKey">S:@company.LastKnownStagingVersion</span></td>
                    <td><a href="@Url.Action("Status", new { company.Id })">@company.Status</a></td>
                    <td>                        
                        <a class="btn" href="@Url.Action("Index", "IBS", new { company.Id })">IBS setup</a>                        
                        <a class="btn" href="@Url.Action("Index", "Layout", new { company.Id })">Layouts</a>
                        <a class="btn" href="@Url.Action("Index", "Version", new { company.Id })">Versions</a>                                                
                        <a class="btn" href="@Url.Action("DeployCustomer", "Deployment", new { company.Id })">Deployment</a>                                                
                    </td>
                    <td>
                        @if (!company.IsValid())
                        {
                            <img data-status title="@company.ValidationError()" src="~/Images/warn.jpg" width="20" />
                        }  
                        @if (HomeController.Is15Ready(company))
                        {
                            <img src="~/Images/check.png" width="20" />
                        }                       
                    </td>
                    <td>
                        
                        @if (!string.IsNullOrEmpty(company.Store.AndroidStoreUrl))
                        {
                            <a href="@company.Store.AndroidStoreUrl">
                                <img src="~/Images/android.png" width="20" />
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(company.Store.AppleStoreId))
                        {
                            <a href="@company.Store.AppleStoreUrl">
                                <img src="~/Images/apple.png" width="20" />
                            </a>
                        }
                        
                           <br />
                            @company.Store.PublishedDateDisplay
                        
                </tr>
            }   
        </table>
    </div>
</div>
@section scripts
{
    @*<script>
        function loadVersion() {
            $(function() {
                $('[data-version]').fetchVersion();
            });
            $(function() {
                $('[data-version-staging]').fetchVersionStaging();
            });
        }
    </script>*@
    
    

    <script type="text/javascript">
        $(function() {
            $('[data-status]').tipsy({ html: true, gravity: 'nw' });
        });
        $('[data-status]').tipsy({ html: true, gravity: 'nw' });

    </script>



}